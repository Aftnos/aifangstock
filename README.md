# 艾方存货管家

该项目是一套使用 Python Tkinter 构建的桌面出入库管理系统，提供从入库登记、出库登记、库存数据查询到数据修改、基础配置等一整套功能，并内置软件授权验证及自动更新机制。数据以 CSV 文件方式存储，适合小型或中型库存场景。

## 功能概览

- **入库登记**：录入供应商、条形码、商品信息、价格等数据，并自动计算结算价。
- **出库登记**：支持多选库存批量出库，记录出库档口和快递单号。
- **数据查询**：提供按商品/供应商统计盈亏、快递单号查询、供应商入库次数统计等多种视图，并可对结果进行筛选与排序。
- **数据修改**：列表式显示所有记录，可根据条件筛选并编辑或删除单条记录。
- **设置**：维护供应商列表、出库档口、数据表（CSV 文件）以及条形码与商品名映射关系。
- **软件更新**：通过远程服务器检查并下载新版本，支持解压或直接执行安装程序。
- **授权管理**：基于硬件信息的授权验证及激活流程，授权信息 AES 加密保存在 `config/license.dat` 中。

## 目录结构

```
├── main.py                 # 程序入口
├── controller.py           # 业务逻辑控制器
├── model.py                # 数据模型，读写 CSV 表
├── settings_model.py       # 设置及条形码映射管理
├── gui_view.py             # 主界面及各功能页的整合
├── inbound_view.py         # 入库登记界面
├── outbound_view.py        # 出库登记界面
├── data_view.py            # 数据查询界面
├── modify_view.py          # 数据修改界面
├── settings_view.py        # 设置界面
├── update_view.py          # 版本更新界面
├── license_view.py         # 授权信息界面
├── license_validator.py    # 授权验证逻辑
├── barcode_model.py        # 简单条形码映射模型
├── server/                 # PHP 实现的授权与更新服务器示例
│   ├── 授权/               # 授权服务器脚本
│   └── 更新/               # 更新服务器脚本及版本文件
└── requirements.txt        # Python 依赖列表
```

运行过程中会在程序目录下创建以下文件夹：

- `data/`：存放每个数据表对应的 CSV 文件。
- `config/`：保存 `settings.json`、`barcode_mappings.json` 以及 `license.dat` 等配置文件。
- `updata/`：下载更新包并执行更新时使用的临时目录。

## 环境依赖

- Python 3.9 及以上版本
- 必需库列在 `requirements.txt` 中，可通过以下命令安装：

```bash
pip install -r requirements.txt
```

部分功能在 Windows 平台下依赖 WMI 获取硬件信息及 Tkinter 图形界面，其他平台的兼容性未做充分测试。

## 启动方式

安装依赖后执行：

```bash
python main.py
```

首次运行若未找到授权文件，会弹出授权窗口并要求输入激活码。授权信息验证通过后即可进入主界面。

## 开发约定

- **代码结构**：遵循 MVC 思路，`model.py` 与 `settings_model.py` 负责数据存取，`controller.py` 负责业务逻辑，视图部分位于各 `*_view.py` 文件中。
- **编码规范**：项目采用标准的 PEP 8 风格，文件使用 UTF‑8 编码，缩进为 4 个空格。
- **数据格式**：库存数据以 GB2312 编码的 CSV 文件保存，表头由 `InventoryModel.CSV_HEADER` 定义。
- **配置管理**：`settings_model.py` 负责读取和保存 `config/settings.json` 及条形码映射文件。
- **扩展指引**：添加新功能页时，可在 `gui_view.py` 的 `Notebook` 中新增 Tab，并在相应的控制器和模型中实现业务逻辑。

## 更新与部署

项目附带 `server/` 目录作为示例实现，包含 PHP 版授权服务器和更新服务器脚本。生产环境可根据自身需求进行二次开发：

1. **授权服务器**：`server/授权/validate.php` 提供激活、校验和远程恢复等接口，需要部署在支持 PHP 7 且具备 MySQL 数据库的环境中。
2. **更新服务器**：`server/更新/index.php` 支持客户端检查更新、下载更新包以及上传新版本，版本信息存储在 `server/更新/version.json`。
3. **客户端配置**：`license_validator.py` 和 `update_view.py` 中分别定义了授权服务器及更新服务器的 URL，可根据部署地址修改。

## 贡献指南

1. 保持代码风格一致，新增依赖请同时更新 `requirements.txt`。
2. 提交前请确保关键功能正常运行，避免引入未捕获的异常。
3. 文档应与代码同步更新，尤其是新增配置项或变更数据结构时。

## License

项目中未包含开源协议，可根据实际情况补充。示例服务器和客户端代码仅供学习与参考，使用前请确保符合当地法律法规及相关条款。

