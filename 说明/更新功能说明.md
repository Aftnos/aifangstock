# 明源出入库管理系统更新功能说明

## 客户端更新功能

### 功能介绍

明源出入库管理系统现已添加自动更新检查功能，可以帮助用户及时获取最新版本的软件。更新功能包括以下特性：

- 检查新版本：连接到更新服务器检查是否有新版本可用
- 下载更新：自动下载新版本安装包
- 安装更新：引导用户完成更新安装过程
- 更新日志：显示新版本的更新内容和改进

### 使用方法

1. 在软件主界面点击「检查更新」选项卡
2. 点击「检查更新」按钮，系统将自动连接服务器检查新版本
3. 如果有新版本可用，点击「下载更新」按钮下载更新包
4. 下载完成后，点击「安装更新」按钮开始安装过程
5. 按照安装向导完成更新

## 服务器端部署说明

### 文件说明

- `update_server.php`：服务器端处理更新请求的PHP脚本
- `version.json.example`：版本信息文件示例

### 部署步骤

1. 准备一个支持PHP 7.0+的Web服务器（Apache、Nginx等）
2. 在服务器上创建一个目录用于存放更新相关文件，例如：`/www/update/`
3. 将`update_server.php`上传到该目录
4. 在该目录下创建以下子目录：
   - `updates/`：用于存放更新包文件
   - `logs/`：用于存放日志文件（脚本会自动创建）
5. 参考`version.json.example`创建`updates/version.json`文件，填写版本信息
6. 将更新包（如`明源出入库管理系统2.1.0.zip`）上传到`updates/`目录

### version.json 文件格式说明

```json
{
  "latest": "2.1.0",  // 最新版本号
  "versions": [  // 版本列表
    {
      "version": "2.1.0",  // 版本号
      "min_required": "2.0.0",  // 最低要求的客户端版本
      "description": "版本描述",  // 简短描述
      "changelog": "更新日志内容",  // 详细更新日志
      "download_url": "下载链接",  // 完整的下载URL
      "file_path": "/updates/文件路径",  // 服务器上的文件路径
      "release_date": "2023-12-15",  // 发布日期
      "size": 15240000  // 文件大小（字节）
    }
  ]
}
```

### 客户端配置

在客户端的`update_view.py`文件中，需要修改`update_server_url`变量为您的实际服务器地址：

```python
self.update_server_url = "http://your-server.com/update.php"
```

## 注意事项

1. 确保服务器具有足够的存储空间和带宽用于更新包的存储和分发
2. 定期检查日志文件，了解客户端更新情况
3. 更新包建议使用ZIP格式，并包含完整的应用程序文件
4. 服务器需要配置适当的安全措施，如HTTPS、访问控制等
5. 在发布新版本前，建议先在测试环境验证更新功能是否正常工作

## 更新日志格式建议

更新日志建议使用以下格式：

```
- [新增] 添加了xxx功能
- [修复] 修复了xxx问题
- [优化] 优化了xxx性能
- [变更] 变更了xxx行为
```

这样可以让用户更清晰地了解每个版本的变化。